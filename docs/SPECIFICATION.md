# アーチェリー点数記録 Web アプリケーション 仕様書

## 1. 概要

### 1.1 目的
アーチェリーの練習・試合における点数を簡単に記録・管理できる Web アプリケーション

### 1.2 対象ユーザー
- アーチェリー競技者（初心者〜上級者）
- スマートフォンからの利用を主とする

### 1.3 技術スタック
- **フロントエンド**: Next.js 14+ (App Router)
- **スタイリング**: Tailwind CSS
- **データベース**: Firestore (Google Cloud)
- **認証**: Firebase Authentication
- **デプロイ**: Google App Engine
- **言語**: TypeScript

## 2. 機能要件

### 2.1 認証機能
- Google アカウントによるログイン
- ログアウト
- 未ログイン時はログイン画面を表示

### 2.2 点数記録機能

#### 2.2.1 ラウンド設定
- **ラウンドタイプ選択**
  - 30m ラウンド (6 射 × 5 エンド)
  - 50m ラウンド (6 射 × 6 エンド)
  - 70m ラウンド (6 射 × 6 エンド)
  - カスタム（射数・エンド数を自由設定）

- **記録情報**
  - 日付（デフォルト: 当日）
  - 時刻（デフォルト: 現在時刻）
  - 場所（任意入力）
  - メモ（任意入力）

#### 2.2.2 点数入力
- **入力方式**
  - 0〜10 点、M（ミス）、X（10 点中心）をタップで入力
  - 大きなタップ領域（スマホで押しやすい）
  - 1 エンドごとに合計点を自動計算
  - 現在の累計点を表示

- **入力サポート**
  - 前のエンドに戻って修正可能
  - 入力中のエンドは一時保存
  - 誤入力時の取り消し機能

#### 2.2.3 リアルタイム表示
- 現在のエンド数
- エンドごとの合計点
- 現在までの累計点
- 平均点（1 射あたり）

### 2.3 履歴閲覧機能

#### 2.3.1 記録一覧
- 過去の記録を新しい順に表示
- 各記録の要約情報
  - 日付・時刻
  - ラウンドタイプ
  - 合計点
  - 場所（設定時のみ）

- **フィルター機能**
  - 日付範囲で絞り込み
  - ラウンドタイプで絞り込み
  - 場所で絞り込み

#### 2.3.2 詳細表示
- エンドごとの点数一覧
- 6 射それぞれの点数
- エンドごとの合計
- 全体の合計点
- 平均点
- メモ内容

#### 2.3.3 記録の編集・削除
- 過去の記録を編集
- 記録の削除（確認ダイアログ表示）

### 2.4 統計機能

#### 2.4.1 基本統計
- 総ラウンド数
- ラウンドタイプ別の平均点
- 最高点
- 最近の推移グラフ（30 日間）

#### 2.4.2 詳細分析
- 点数分布（0〜10、X の出現率）
- エンド別平均点
- 時間帯別のパフォーマンス
- 場所別の平均点

## 3. 画面設計

### 3.1 画面一覧
1. ログイン画面
2. ホーム画面（ダッシュボード）
3. ラウンド設定画面
4. 点数入力画面
5. 履歴一覧画面
6. 記録詳細画面
7. 統計画面
8. 設定画面

### 3.2 画面遷移
```
ログイン画面
  ↓
ホーム画面 ←→ 履歴一覧画面 → 記録詳細画面
  ↓              ↓
ラウンド設定画面  統計画面
  ↓
点数入力画面
```

### 3.3 UI/UX 要件
- **レスポンシブデザイン**
  - モバイルファースト
  - タブレット・PC でも表示可能

- **タッチ操作最適化**
  - ボタンサイズ: 最小 48×48px
  - タップ領域の適切な余白
  - スワイプジェスチャー対応（前後のエンド移動）

- **パフォーマンス**
  - 初期表示 2 秒以内
  - ページ遷移の高速化
  - オフライン対応（PWA 化）

## 4. データ構造

### 4.1 Users コレクション
```typescript
interface User {
  uid: string;
  email: string;
  displayName: string;
  createdAt: Timestamp;
  updatedAt: Timestamp;
}
```

### 4.2 Rounds コレクション
```typescript
interface Round {
  id: string;
  userId: string;
  type: 'standard' | 'custom';
  distance: 30 | 50 | 70 | number;
  endsCount: number;
  arrowsPerEnd: number;
  date: Timestamp;
  location?: string;
  memo?: string;
  totalScore: number;
  averageScore: number;
  ends: End[];
  createdAt: Timestamp;
  updatedAt: Timestamp;
}

interface End {
  endNumber: number;
  scores: Score[];
  total: number;
}

interface Score {
  value: number | 'M' | 'X';
  displayValue: string;
  numericValue: number;
}
```

## 5. 非機能要件

### 5.1 セキュリティ
- Firebase Authentication による認証
- Firestore Security Rules でユーザーデータ保護
- HTTPS 通信の強制

### 5.2 パフォーマンス
- Server Components の活用
- 画像最適化（Next.js Image）
- データの遅延読み込み
- キャッシュ戦略の実装

### 5.3 可用性
- App Engine による自動スケーリング
- エラーハンドリングの実装
- フォールバック UI の提供

### 5.4 保守性
- TypeScript による型安全性
- ESLint/Prettier によるコード品質維持
- コンポーネントの再利用性
- テストコードの実装（Jest/React Testing Library）

## 6. 開発フェーズ

### Phase 1: MVP（最小限の機能）
- 認証機能
- 基本的な点数入力（30m ラウンドのみ）
- 記録一覧表示
- 記録詳細表示

### Phase 2: 機能拡張
- 複数ラウンドタイプ対応
- カスタムラウンド設定
- 記録の編集・削除
- 基本統計表示

### Phase 3: 高度な機能
- 詳細分析機能
- グラフ表示
- PWA 化（オフライン対応）
- データエクスポート機能

## 7. 今後の拡張案
- 写真添付機能（的の写真など）
- 複数人での記録共有
- コーチ機能（他ユーザーの記録閲覧）
- 目標設定・達成管理
- SNS 共有機能
- 競技会記録の管理
